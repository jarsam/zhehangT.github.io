---
title: GPU升级小记
date: 2017-07-15 13:00:00
tags:
categories: 折腾日记
description: 旧机子升级新显卡小记
---
<!-- more -->

# 摘要
在实验室这台4年前的3代i5的机子上撸深度学习真是件令人崩溃的事。能有一块Titan X成了心中的小梦想，1080ti也凑合吧。某个夜晚辗转反侧思索良久，梦想是用来实现的，钱不花出去都是纸。所以，下单1050ti。毕竟梦想很丰满，现实很骨感。

# 选购
简单总结下已有的硬件，H61的骨灰级主板，3代i5，5400转500G超大硬盘，2条4G内存，280W电源，办公用小机箱以及步骤AMD不知道啥型号的显卡。我在想，搞做深度学习方面研究的童鞋们还有比我更渣的机器吗。多说都是类。
鉴于手头的资金有限，考虑升级1050ti或者1060。万恶的矿工们，搞得显卡价格蹭蹭涨，唉。
简单调研了下，1050ti建议电源300w，尺寸中等，网上有成功在H61上装1050ti的案例。1060建议电源500w，尺寸大，网上有说H61需要升级bios才能点亮1060。鉴于条件艰苦，还是保守1050ti吧。具体型号：微星红龙1050ti。

# 安装
刷掉一个月生活费，1050ti终于出现在我的手上。
拆机箱，拆显卡，上1050ti，打开电源。嗯，果然显卡没有任何反映。我...难道是主板太旧了...我的生活费...内心是崩溃的...
其实其实就是外接电源没接上，不是说好的1050ti不需要外接电源也能用吗。新购4pin转6pin电源线，插上成功点亮。可是，插上新显卡后进不了ubuntu系统...生活真是多磨难...
猜测肯定是驱动的原因，于是禁用独显，用集显输出，成功进入系统，用ubuntu自带的附加驱动程序安装1050ti的显卡驱动...搞定！
接下来就是搭环境了。
- 安装cuda
从官网下载相应版本的安装程序。大家都推荐本地运行的run文件。
注意，安装过程中在询问是否安装驱动时选择否，否则后果很严重，大家都是这么说的。
- 安装cuddn
从官网下载相应版本的库文件，将库文件拷贝到相应的cuda安装目录中，并重新建立软连接。
- 重新编译caffe
之前安装了cpu-only 的caffe，所以在编译前通过 make clean 删除之前编译生成的文件，否则make test会出错。

大功告成！

# 测试
简单测试下1050ti的性能。
运行caffe自带的example中的用caffenet做分类的例子。

在CPU模式下：
```python
%timeit
%timeit net.forward()
# 1 loop, best of 3: 4.97 s per loop
```

在GPU模式下：
```python
caffe.set_device(0)  # if we have multiple GPUs, pick the first one
caffe.set_mode_gpu()
net.forward()  # run once before timing to set up memory
%timeit net.forward()
# 10 loops, best of 3: 71.9 ms per loop
````

# 后记
我想要Titan X，我不管我就是要Titan X。


