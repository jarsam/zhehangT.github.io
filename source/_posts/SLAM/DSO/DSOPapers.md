---
title: DSO 论文大杂烩
date: 2019-01-31 10:11:25
tags:
- DSO
categories:
- 机器人事业
- SLAM
description: DSO 论文大杂烩。包括DOS，双目DSO，回环DOS以及DOS+IMU
---
<!-- more -->

# DSO
DSO，又名稀疏直接法。刚问世的时候，在 SLAM 领域中就像是一股清流。因其炫酷的可视化效果，火遍朋友圈。那到底何为直接法，那得从特征点法说起。
特征点法，通常就是三板斧。首先是对图像提取图像特征（如ORB，FAST等）。其次就是在两帧图像之间建立特征匹配关系。这一步通常有两种方法，第一种为描述子匹配（如ORBSLAM），第二种为光流匹配（如VINS）。最后就是求解位姿。根据已知的条件，可以使用对极约束（2D-2D），PnP、BA（3D-2D），ICP（3D-3D）等方法。
而直接法，只需要图像之间的灰度误差关系，即可完成位姿求解。简直就是耍流氓。
因此，简单来讲，特征点法，优化目标是使得特征匹配时的几何误差（坐标误差）最小，通常称为 geometric error，因此非常依赖于特征的匹配是否正确。而直接法，优化目标是图像间的灰度误差最小，通常称为 photometric error，因此非常依赖于图像间的灰度一致性。直接法更加详细的基本概念可以先参考十四讲。

DOS论文洋洋洒洒十几好页，其中最关键的就是下面的残差函数。接下来将详细讲解这个残差函数。
![](1.png)
（1）$p \in N\_p$ 即为下图的选点策略。选取8个点方便SSE加速。
![](2.png)
（2）$w\_p$表示权重，计算方式如下。（这个c到底是个啥？）
![](3.png)
（3）$t\_i, t\_j$分别表示 $i$ 和 $j$ 时刻的相机曝光时间。$a\_i, b\_i, a\_j, b\_j$表示亮度转移函数参数（brightness transfer function parameters）。因此（4）中相减的两项，即为光度修正后的图像灰度值。
（4）$p$ 和 $p'$ 分别表示像素点在$i$ 和 $j$ 时刻的坐标，其满足以下转换关系。其中 $d\_p$ 表示逆深度。
![](4.png)

因此，每个关键帧时刻，对于滑窗内的关键帧，DSO会建立如下的优化函数，优化变量为滑动窗内每一时刻的帧Pose，点的逆深度，当然也可以再优化内参、曝光时间和亮度转移函数。
![](5.png)
![](6.png)

在DSO中，选择哪些点加入到滑动窗口中进行优化，对最终的结果将会产生决定性的影响，DSO中的稀疏二字，代表着在每个图像帧中，将会有选择性的选择某些像素，而不是全部像素。对于直接法的优化问题，将产生如下的雅可比矩阵。
![](7.png)
可以看到雅可比矩阵的第一项即为像素梯度，因此对于每个图像帧，只有那些具备梯度的像素，才具备被优化的条件。这是直接法选点的第一个条件。
其次在优化地图点的过程中，当调整地图点的逆深度，其投影到其他图像帧时，是在极线上变化的，如果该极线上的像素值都是一样的，那么直接法优化的残差函数将不产生任何变化。这是直接法选点的第二个条件，即极线上必须是有像素变化的。
为了得到更加准确的优化结果，选点时还需要使其均匀分布在图像中，这是直接法选点的第三个条件。

关于 **First Estimate Jacobians** 和 **Marginalization** 的内容就不展开说了,[1][2][3]都讲的非常透彻，以后有机会再写写自己的理解。

# 双目DSO
// TODO
# DSO+IMU
// TODO
# LDSO
// TODO


# 参考文献
1. [DSO详解](https://zhuanlan.zhihu.com/p/29177540)
2. [如何理解SLAM中的First-Estimates Jacobian？]https://www.zhihu.com/question/52869487
3. [DSO 中的Windowed Optimization]https://blog.csdn.net/heyijia0327/article/details/53707261








